create database Concesionario;
-- Usar la base de datos correspondiente, reemplaza `tu_base_de_datos` con el nombre de la base de datos
USE Concesionario;

-- Tabla PERSONA
CREATE TABLE PERSONA (
   CEDULA INT(8) NOT NULL,
   NOMBRE VARCHAR(20) NOT NULL,
   APELLIDOS VARCHAR(20) NOT NULL,
   DIRECCION VARCHAR(20) NOT NULL,
   TELEFONO VARCHAR(20) NOT NULL,
   PRIMARY KEY (CEDULA)
);

-- Tabla COMPRA
CREATE TABLE COMPRA (
   NUMERO_FACTURA INT(8) NOT NULL AUTO_INCREMENT,
   CEDULA_CLIENTE INT(8) NOT NULL,
   CEDULA_VENDEDOR INT(8) NOT NULL,
   PLACA VARCHAR(20) NOT NULL, 
   PRECIO_TOTAL DECIMAL(10, 2) NOT NULL,
   FECHA DATE NOT NULL,
   PRIMARY KEY (NUMERO_FACTURA)
);

-- Tabla DETALLE_COMPRA
CREATE TABLE DETALLE_COMPRA (
   ID_DETALLE INT(8) NOT NULL AUTO_INCREMENT,	
   NUMERO_FACTURA INT(8) NOT NULL,
   ID_OPCIONES_MODELO INT(8) NOT NULL,
   PRIMARY KEY (ID_DETALLE)
);

-- Tabla OPCIONES_MODELO
CREATE TABLE OPCIONES_MODELO (
   ID_OPCIONES_MODELO INT(8) NOT NULL AUTO_INCREMENT, 	
   NOMBRE VARCHAR(20) NOT NULL,
   DESCRIPCION VARCHAR(20) NOT NULL,
   PRIMARY KEY (ID_OPCIONES_MODELO)
);

-- Tabla VEHICULO
CREATE TABLE VEHICULO (
   PLACA VARCHAR(20) NOT NULL, 
   ID_REFERENCIA INT(8) NOT NULL,
   PRECIO DECIMAL(10, 2) NOT NULL,
   ESTADO CHAR(1) NOT NULL,
   PRIMARY KEY (PLACA)
);

-- Tabla REFERENCIA
CREATE TABLE REFERENCIA (
   ID_REFERENCIA INT(8) NOT NULL AUTO_INCREMENT, 
   MARCA VARCHAR(20) NOT NULL,
   MODELO VARCHAR(20) NOT NULL,
   ANIO INT(4) NOT NULL,
   PRIMARY KEY (ID_REFERENCIA)
);

-- Tabla CESION
CREATE TABLE CESION (
   ID_CESION INT(8) NOT NULL AUTO_INCREMENT,
   PLACA VARCHAR(20) NOT NULL,
   NUMERO_FACTURA INT(8) NOT NULL,
   TASACION DECIMAL(10, 2) NOT NULL,
   FECHA_CESION DATE NOT NULL,
   PRIMARY KEY (ID_CESION)
);

-- Definición de claves foráneas y restricciones
ALTER TABLE COMPRA
   ADD CONSTRAINT FK_CLIENTE_COMPRA FOREIGN KEY (CEDULA_CLIENTE) REFERENCES PERSONA (CEDULA);

ALTER TABLE COMPRA
   ADD CONSTRAINT FK_VENDEDOR_COMPRA FOREIGN KEY (CEDULA_VENDEDOR) REFERENCES PERSONA (CEDULA);

ALTER TABLE COMPRA
   ADD CONSTRAINT FK_VEHICULO_COMPRA FOREIGN KEY (PLACA) REFERENCES VEHICULO (PLACA);

ALTER TABLE DETALLE_COMPRA
   ADD CONSTRAINT FK_COMPRA_DETALLE_COMPRA FOREIGN KEY (NUMERO_FACTURA) REFERENCES COMPRA (NUMERO_FACTURA);

ALTER TABLE DETALLE_COMPRA
   ADD CONSTRAINT FK_DETALLE_COMPRA_OPCIONES_MODELO FOREIGN KEY (ID_OPCIONES_MODELO) REFERENCES OPCIONES_MODELO (ID_OPCIONES_MODELO);

ALTER TABLE VEHICULO
   ADD CONSTRAINT FK_VEHICULO_REFERENCIA FOREIGN KEY (ID_REFERENCIA) REFERENCES REFERENCIA (ID_REFERENCIA);

ALTER TABLE CESION
   ADD CONSTRAINT FK_COMPRA_CESION FOREIGN KEY (NUMERO_FACTURA) REFERENCES COMPRA (NUMERO_FACTURA);

ALTER TABLE CESION
   ADD CONSTRAINT FK_VEHICULO_CESION FOREIGN KEY (PLACA) REFERENCES VEHICULO (PLACA);

-- Restricciones de verificación
ALTER TABLE COMPRA
   ADD CONSTRAINT CK_CLIENTE_VENDEDOR CHECK (CEDULA_CLIENTE != CEDULA_VENDEDOR);

ALTER TABLE VEHICULO
   ADD CONSTRAINT CK_ESTADO_VEHICULO CHECK (ESTADO IN ('N', 'U'));

-- Creación de índices
CREATE INDEX CLIENTE_COMPRA_FK ON COMPRA (CEDULA_CLIENTE);
CREATE INDEX VENDEDOR_COMPRA_FK ON COMPRA (CEDULA_VENDEDOR);
CREATE INDEX VEHICULO_COMPRA_FK ON COMPRA (PLACA);
CREATE INDEX COMPRA_DETALLE_COMPRA_FK ON DETALLE_COMPRA (NUMERO_FACTURA);
CREATE INDEX DETALLE_COMPRA_OPCIONES_MODELO_FK ON DETALLE_COMPRA (ID_OPCIONES_MODELO);
CREATE INDEX VEHICULO_REFERENCIA_FK ON VEHICULO (ID_REFERENCIA);
CREATE INDEX COMPRA_CESION_FK ON CESION (NUMERO_FACTURA);
CREATE INDEX VEHICULO_CESION_FK ON CESION (PLACA);
